"use strict";(self.webpackChunksrcful_documentation=self.webpackChunksrcful_documentation||[]).push([[1123],{956:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>t,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"developer/zap-local-api","title":"Zap Local API","description":"Complete endpoint documentation for the Zap firmware.","source":"@site/docs/developer/zap-local-api.md","sourceDirName":"developer","slug":"/developer/zap-local-api","permalink":"/developer/zap-local-api","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"sidebar_position":6,"sidebar_label":"Zap Local API","slug":"/developer/zap-local-api"},"sidebar":"docs","previous":{"title":"Zap for Developers","permalink":"/developer/zap-for-developers"},"next":{"title":"Design manual and press","permalink":"/developer/design-manual"}}');var r=s(4848),d=s(8453);const l={sidebar_position:6,sidebar_label:"Zap Local API",slug:"/developer/zap-local-api"},c="Zap Local API",t={},a=[{value:"Table of Contents",id:"table-of-contents",level:2},{value:"Base URL",id:"base-url",level:2},{value:"System &amp; Network",id:"system--network",level:2},{value:"GET /api/system",id:"get-apisystem",level:3},{value:"POST /api/system/reboot",id:"post-apisystemreboot",level:3},{value:"POST /api/system/factory-reset",id:"post-apisystemfactory-reset",level:3},{value:"POST /api/system/log_stream",id:"post-apisystemlog_stream",level:3},{value:"GET /api/wifi",id:"get-apiwifi",level:3},{value:"POST /api/wifi",id:"post-apiwifi",level:3},{value:"DELETE /api/wifi",id:"delete-apiwifi",level:3},{value:"GET /api/wifi/scan",id:"get-apiwifiscan",level:3},{value:"POST /api/ble/stop",id:"post-apiblestop",level:3},{value:"Device Management",id:"device-management",level:2},{value:"GET /api/devices/supported",id:"get-apidevicessupported",level:3},{value:"GET /api/devices/types",id:"get-apidevicestypes",level:3},{value:"GET /api/devices",id:"get-apidevices",level:3},{value:"POST /api/devices",id:"post-apidevices",level:3},{value:"DELETE <code>/api/devices/{sn}</code>",id:"delete-apidevicessn",level:3},{value:"DELETE /api/devices",id:"delete-apidevices",level:3},{value:"GET <code>/api/devices/{sn}/data/json</code>",id:"get-apidevicessndatajson",level:3},{value:"POST <code>/api/devices/{sn}/types</code>",id:"post-apidevicessntypes",level:3},{value:"GET <code>/api/devices/{sn}/ders</code>",id:"get-apidevicessnders",level:3},{value:"POST <code>/api/devices/{sn}/ders</code>",id:"post-apidevicessnders",level:3},{value:"GET <code>/api/devices/{sn}/registers/{address}</code>",id:"get-apidevicessnregistersaddress",level:3},{value:"POST <code>/api/devices/{sn}/registers/{address}</code>",id:"post-apidevicessnregistersaddress",level:3},{value:"POST <code>/api/devices/{sn}/registers</code>",id:"post-apidevicessnregisters",level:3},{value:"POST <code>/api/devices/{sn}/write</code>",id:"post-apidevicessnwrite",level:3},{value:"Control &amp; Operations",id:"control--operations",level:2},{value:"POST <code>/api/control/{sn}/init</code>",id:"post-apicontrolsninit",level:3},{value:"POST <code>/api/control/{sn}/battery</code>",id:"post-apicontrolsnbattery",level:3},{value:"POST <code>/api/control/{sn}/curtail</code>",id:"post-apicontrolsncurtail",level:3},{value:"POST <code>/api/control/{sn}/curtail/disable</code>",id:"post-apicontrolsncurtaildisable",level:3},{value:"POST <code>/api/control/{sn}/deinit</code>",id:"post-apicontrolsndeinit",level:3},{value:"MQTT Control Topics",id:"mqtt-control-topics",level:3},{value:"Battery Control",id:"battery-control",level:4},{value:"PV Curtailment",id:"pv-curtailment",level:4},{value:"Identity &amp; Security",id:"identity--security",level:2},{value:"GET /api/crypto",id:"get-apicrypto",level:3},{value:"POST /api/crypto/sign",id:"post-apicryptosign",level:3},{value:"GET /api/name",id:"get-apiname",level:3},{value:"Utilities",id:"utilities",level:2},{value:"GET /api/debug",id:"get-apidebug",level:3},{value:"POST /api/echo",id:"post-apiecho",level:3},{value:"Reference",id:"reference",level:2},{value:"Status Codes",id:"status-codes",level:3},{value:"Examples",id:"examples",level:3},{value:"Notes",id:"notes",level:3}];function o(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"zap-local-api",children:"Zap Local API"})}),"\n",(0,r.jsx)(n.p,{children:"Complete endpoint documentation for the Zap firmware."}),"\n",(0,r.jsx)(n.h2,{id:"table-of-contents",children:"Table of Contents"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"#system--network",children:"System & Network"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#get-apisystem",children:"System Info"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#post-apisystemreboot",children:"System Reboot"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#post-apisystemfactory-reset",children:"Factory Reset"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#get-apiwifi",children:"WiFi Status"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#post-apiwifi",children:"WiFi Config"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#delete-apiwifi",children:"WiFi Reset"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#get-apiwifiscan",children:"WiFi Scan"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"#device-management",children:"Device Management"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#get-apidevicessupported",children:"Supported Devices"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#get-apidevicestypes",children:"Connection Types"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#get-apidevices",children:"List Devices"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#post-apidevices",children:"Add Device"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#delete-apidevicessen",children:"Remove Device"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#get-apidevicessndatajson",children:"Device Data"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#post-apidevicessentypes",children:"Update DER Types"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#get-apidevicessnders",children:"Get DER Metadata"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#post-apidevicessnders",children:"Update DER Metadata"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#get-apidevicessnregistersaddress",children:"Read Registers"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#post-apidevicessnregistersaddress",children:"Write Register"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"#control--operations",children:"Control & Operations"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#post-apicontrolsninit",children:"Init Control"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#post-apicontrolsnbattery",children:"Battery Control"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#post-apicontrolsncurtail",children:"PV Curtailment"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#post-apicontrolsncurtaildisable",children:"Disable Curtailment"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#post-apicontrolsndeinit",children:"Deinit Control"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#mqtt-control-topics",children:"MQTT Topics"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"#identity--security",children:"Identity & Security"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#get-apicrypto",children:"Crypto Info"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#post-apicryptosign",children:"Sign Message"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#get-apiname",children:"Device Name"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"#utilities",children:"Utilities"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#get-apidebug",children:"Debug Info"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#post-apiecho",children:"Echo"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"#reference",children:"Reference"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#status-codes",children:"Status Codes"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#examples",children:"Examples"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#notes",children:"Notes"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"base-url",children:"Base URL"}),"\n",(0,r.jsxs)(n.p,{children:["All endpoints prefixed with ",(0,r.jsx)(n.code,{children:"/api/"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["Example: ",(0,r.jsx)(n.code,{children:"http://192.168.1.100/api/system"})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"system--network",children:"System & Network"}),"\n",(0,r.jsx)(n.h3,{id:"get-apisystem",children:"GET /api/system"}),"\n",(0,r.jsx)(n.p,{children:"System info, memory, WiFi status, uptime."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Response"})," (200):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "time_utc_sec": 1697515200,\n  "uptime_seconds": 123456,\n  "temperature_celsius": 0.0,\n  "memory_kb": {\n    "total": 4096.0,\n    "free": 2560.0,\n    "used": 1536.0,\n    "percent_used": 37.5,\n    "min": 2048.0,\n    "largest": 1024.0\n  },\n  "processes_average": {\n    "last_1min": 0,\n    "last_5min": 0,\n    "last_15min": 0\n  },\n  "logging": {\n    "enabled": true,\n    "level": 4\n  },\n  "zap": {\n    "deviceId": "abc123",\n    "cpuFreqMHz": 160,\n    "flashSizeMB": 0.0,\n    "sdkVersion": "v5.1",\n    "firmwareVersion": "1.0.0",\n    "publicKey": "04a1b2c3...",\n    "network": {\n      "wifiStatus": "connected",\n      "wifiConnected": true,\n      "localIP": "192.168.1.100",\n      "ssid": "MyNetwork",\n      "rssi": -45,\n      "internetConnected": true\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"post-apisystemreboot",children:"POST /api/system/reboot"}),"\n",(0,r.jsx)(n.p,{children:"Reboot device after 5s delay."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Response"})," (200):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "status": "success",\n  "message": "System is rebooting in 5 seconds"\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"post-apisystemfactory-reset",children:"POST /api/system/factory-reset"}),"\n",(0,r.jsx)(n.p,{children:"Factory reset the device. Clears all device configurations and WiFi credentials, then reboots."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Response"})," (200):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "message": "Factory reset successful. Rebooting in 2 seconds."\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"post-apisystemlog_stream",children:"POST /api/system/log_stream"}),"\n",(0,r.jsxs)(n.p,{children:["Toggle real-time log streaming to MQTT. When enabled, device logs are published to ",(0,r.jsx)(n.code,{children:"logs/{gateway_id}/raw"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Request"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "enabled": true,\n  "level": 4\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.em,{children:["Note: ",(0,r.jsx)(n.code,{children:"level"})," is optional (default: 4/INFO). Levels: 1=ERROR, 2=WARN, 3=OK, 4=INFO, 5=DEBUG, 6=VERBOSE."]})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Response"})," (200):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "enabled": true,\n  "status": "ok"\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"get-apiwifi",children:"GET /api/wifi"}),"\n",(0,r.jsx)(n.p,{children:"Get WiFi status and scan results."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Response"})," (200):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "ssids": [\n    { "ssid": "Network1", "rssi": -60, "auth": "WPA2" },\n    { "ssid": "Network2", "rssi": -80, "auth": "OPEN" }\n  ],\n  "connected": "Network1"\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.em,{children:["Note: ",(0,r.jsx)(n.code,{children:"connected"})," is null if not connected."]})}),"\n",(0,r.jsx)(n.h3,{id:"post-apiwifi",children:"POST /api/wifi"}),"\n",(0,r.jsx)(n.p,{children:"Set WiFi credentials and connect."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Request"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "ssid": "MyNetwork",\n  "psk": "mypassword"\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Response"})," (200):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "status": "success",\n  "message": "WiFi credentials updated and connected"\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"delete-apiwifi",children:"DELETE /api/wifi"}),"\n",(0,r.jsx)(n.p,{children:"Clear WiFi credentials and disconnect."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Response"})," (200):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "status": "success",\n  "message": "WiFi credentials cleared, disconnecting in 5 seconds"\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"get-apiwifiscan",children:"GET /api/wifi/scan"}),"\n",(0,r.jsxs)(n.p,{children:["Initiate a WiFi scan. Results will be available in ",(0,r.jsx)(n.code,{children:"GET /api/wifi"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Response"})," (200):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "status": "sucess",\n  "message": "scan initiated"\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"post-apiblestop",children:"POST /api/ble/stop"}),"\n",(0,r.jsx)(n.p,{children:"Stop the BLE service."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Response"})," (200):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "status": "success",\n  "message": "BLE stopping..."\n}\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"device-management",children:"Device Management"}),"\n",(0,r.jsx)(n.h3,{id:"get-apidevicessupported",children:"GET /api/devices/supported"}),"\n",(0,r.jsx)(n.p,{children:"List supported device profiles."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Response"})," (200):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "count": 3,\n  "inverters": [\n    { \n      "display_name": "Sungrow", \n      "profile": "sungrow",\n      "connection_types": ["modbus_tcp", "modbus_rtu"]\n    },\n    { \n      "display_name": "Solis", \n      "profile": "solis",\n      "connection_types": ["modbus_tcp", "modbus_rtu"]\n    }\n  ],\n  "meters": [\n    {\n      "display_name": "P1 Meter",\n      "profile": "p1_meter",\n      "connection_types": ["p1_uart"]\n    }\n  ],\n  "ev_chargers": [\n    {\n      "display_name": "Ambibox",\n      "profile": "ambibox",\n      "connection_types": ["mqtt"]\n    }\n  ]\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"get-apidevicestypes",children:"GET /api/devices/types"}),"\n",(0,r.jsx)(n.p,{children:"List all possible connection types and their required/optional parameters for creating a device."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Response"})," (200):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "connection_types": [\n    {\n      "type": "modbus_tcp",\n      "description": "Modbus TCP connection",\n      "parameters": [\n        { "name": "ip", "type": "string", "required": true },\n        { "name": "port", "type": "integer", "required": true, "default": 502 },\n        { "name": "unit_id", "type": "integer", "required": true, "default": 1 },\n        { "name": "profile", "type": "string", "required": true }\n      ]\n    },\n    {\n      "type": "modbus_rtu",\n      "description": "Modbus RTU connection over RS485",\n      "parameters": [\n        { "name": "baud_rate", "type": "integer", "required": true, "default": 9600 },\n        { "name": "unit_id", "type": "integer", "required": true, "default": 1 },\n        { "name": "profile", "type": "string", "required": true },\n        { "name": "parity", "type": "integer", "required": false, "default": 0, "description": "0=None, 1=Odd, 2=Even" },\n        { "name": "data_bits", "type": "integer", "required": false, "default": 8 },\n        { "name": "stop_bits", "type": "integer", "required": false, "default": 1 }\n      ]\n    },\n    {\n      "type": "p1_uart",\n      "description": "P1 Port (DSMR) connection",\n      "parameters": [\n        { "name": "manufacturer", "type": "string", "required": false },\n        { "name": "baud_rate", "type": "integer", "required": true, "default": 115200 },\n        { "name": "data_bits", "type": "integer", "required": true, "default": 8 },\n        { "name": "parity", "type": "string", "required": false, "default": "none", "description": "none, even, odd" },\n        { "name": "stop_bits", "type": "integer", "required": false, "default": 1 }\n      ]\n    },\n    {\n      "type": "mqtt",\n      "description": "MQTT connection",\n      "parameters": [\n        { "name": "broker_host", "type": "string", "required": true },\n        { "name": "broker_port", "type": "integer", "required": true, "default": 1883 },\n        { "name": "username", "type": "string", "required": false },\n        { "name": "password", "type": "string", "required": false },\n        { "name": "client_id", "type": "string", "required": false }\n      ]\n    }\n  ]\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"get-apidevices",children:"GET /api/devices"}),"\n",(0,r.jsx)(n.p,{children:"List all configured devices. Each entry is the persisted config augmented with runtime:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"connected"}),": boolean \u2013 current connection state"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"last_harvest"}),": unix ms timestamp of most recent DER data (omitted if none yet)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"path"}),": string \u2013 the path to the configuration file in SPIFFS (e.g. ",(0,r.jsx)(n.code,{children:"spiffs/devices/6178e775.json"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ders"}),": per-DER entries (pv/battery/meter/v2x_charger) with publish flags; PV entries also expose ",(0,r.jsx)(n.code,{children:"installed_power"})," (W) alongside persisted ",(0,r.jsx)(n.code,{children:"rated_power"})," (W) and battery ",(0,r.jsx)(n.code,{children:"capacity"})," (Wh)"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Response"})," (200):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "count": 2,\n  "devices": [\n    {\n      "type": "modbus_tcp",\n      "ip": "192.168.1.60",\n      "port": 502,\n      "unit_id": 1,\n      "profile": "sungrow",\n      "sn": "INV003SIM03",\n      "connected": true,\n      "last_harvest": 1761832393075,\n      "path": "spiffs/devices/6178e775.json",\n      "ders": [\n        {\n          "type": "pv",\n          "enabled": false,\n          "installed_power": 9500,\n          "rated_power": 10000\n        },\n        {\n          "type": "battery",\n          "enabled": false,\n          "rated_power": 5000,\n          "capacity": 10000\n        },\n        {\n          "type": "meter",\n          "enabled": false\n        }\n      ]\n    },\n    {\n      "type": "mqtt",\n      "broker_host": "192.168.1.50",\n      "broker_port": 1883,\n      "username": "user",\n      "client_id": "esp32_local",\n      "sn": "ambibox_192.168.1.50",\n      "connected": false,\n      "ders": [\n        {\n          "type": "v2x_charger",\n          "enabled": false,\n          "capacity": 0\n        }\n      ]\n    }\n  ]\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"post-apidevices",children:"POST /api/devices"}),"\n",(0,r.jsx)(n.p,{children:"Add device. Connects immediately, saved only on success."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Modbus TCP"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "type": "modbus_tcp",\n  "ip": "192.168.1.60",\n  "port": 502,\n  "unit_id": 1,\n  "profile": "sungrow"\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Modbus RTU"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "type": "modbus_rtu",\n  "baud_rate": 9600,\n  "unit_id": 1,\n  "profile": "sungrow",\n  "parity": 0\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"P1 UART"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "type": "p1_uart",\n  "manufacturer": "MyMeter",\n  "baud_rate": 115200,\n  "data_bits": 8,\n  "parity": "none",\n  "stop_bits": 1\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"P1 UART Configuration Options"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"baud_rate"}),": Integer > 0 (e.g., 9600, 115200)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"data_bits"}),": 5, 6, 7, 8"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"parity"}),': "none", "even", "odd"']}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"stop_bits"}),': 1, 2, "1.5"']}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"MQTT"})," (Ferroamp EnergyHub):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "type": "mqtt",\n  "profile": "ferroamp",\n  "broker_host": "192.168.1.70",\n  "broker_port": 1883,\n  "username": "extapi",\n  "password": "your_password"\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"MQTT"})," (Ambibox EV Charger):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "type": "mqtt",\n  "profile": "ambibox",\n  "broker_host": "192.168.1.70",\n  "broker_port": 1884,\n  "username": "external-ems",\n  "password": "your_password"\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Response"})," (201):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "message": "Device added and connected",\n  "sn": "INV003SIM03",\n  "ders": [\n    {\n      "type": "pv",\n      "enabled": false,\n      "rated_power": 10000\n    },\n    {\n      "type": "battery",\n      "enabled": false,\n      "rated_power": 0,\n      "capacity": 0\n    },\n    {\n      "type": "meter",\n      "enabled": false\n    }\n  ]\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Errors"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"400 - Invalid config"}),"\n",(0,r.jsx)(n.li,{children:"409 - Device exists or conflicts (UART/TCP endpoint)"}),"\n",(0,r.jsx)(n.li,{children:"503 - Connection failed or insufficient memory (requires >55KB free heap)"}),"\n"]}),"\n",(0,r.jsxs)(n.h3,{id:"delete-apidevicessn",children:["DELETE ",(0,r.jsx)(n.code,{children:"/api/devices/{sn}"})]}),"\n",(0,r.jsx)(n.p,{children:"Remove device by serial number."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Example"}),": ",(0,r.jsx)(n.code,{children:"DELETE /api/devices/INV003SIM03"})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Response"})," (200):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{ "message": "Device removed" }\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Errors"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"404 - Device not found"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"delete-apidevices",children:"DELETE /api/devices"}),"\n",(0,r.jsx)(n.p,{children:"Remove all devices. Clears runtime memory and deletes all device configurations from storage."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Example"}),": ",(0,r.jsx)(n.code,{children:"DELETE /api/devices"})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Response"})," (200):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{ "message": "All devices removed" }\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Errors"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"500 - Failed to clear devices (e.g. SPIFFS error)"}),"\n"]}),"\n",(0,r.jsxs)(n.h3,{id:"get-apidevicessndatajson",children:["GET ",(0,r.jsx)(n.code,{children:"/api/devices/{sn}/data/json"})]}),"\n",(0,r.jsx)(n.p,{children:"Latest device data snapshot in JSON format."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Example"}),": ",(0,r.jsx)(n.code,{children:"GET /api/devices/INV003SIM03/data/json"})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Response"})," (200):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "pv": {\n    "type": "pv",\n    "timestamp": 1761832393075,\n    "read_time_ms": 472,\n    "make": "Sungrow",\n    "W": 2500,\n    "total_generation_Wh": 22698000\n  },\n  "battery": {\n    "type": "battery",\n    "timestamp": 1761832393075,\n    "make": "ambibox",\n    "sessionState": "CHARGE_LOOP",\n    "W": -500,\n    "SoC_nom_fract": 85\n  },\n  "meter": { /* ... if present ... */ },\n  "version": "v0",\n  "format": "sungrow"\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Errors"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"204 - No harvest data yet"}),"\n",(0,r.jsx)(n.li,{children:"404 - Device not found"}),"\n"]}),"\n",(0,r.jsxs)(n.h3,{id:"post-apidevicessntypes",children:["POST ",(0,r.jsx)(n.code,{children:"/api/devices/{sn}/types"})]}),"\n",(0,r.jsx)(n.p,{children:"Enable/disable publishing for detected DERs on a device. Only included DERs in the request are modified. Omitted entries remain unchanged."}),"\n",(0,r.jsxs)(n.p,{children:["By default, all detected DERs have ",(0,r.jsx)(n.code,{children:"enabled = false"})," on first connection."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Request"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "ders": [\n    { "type": "pv", "enabled": true },\n    { "type": "battery", "enabled": false }\n  ]\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Response"})," (200):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{ "message": "Types updated", "sn": "INV003SIM03" }\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Errors"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"400 - Missing ders array"}),"\n",(0,r.jsx)(n.li,{children:"404 - Device not found"}),"\n",(0,r.jsx)(n.li,{children:"500 - Failed to persist config"}),"\n"]}),"\n",(0,r.jsxs)(n.h3,{id:"get-apidevicessnders",children:["GET ",(0,r.jsx)(n.code,{children:"/api/devices/{sn}/ders"})]}),"\n",(0,r.jsx)(n.p,{children:"Fetch publish state plus configured DER metadata. The fields returned are the user-configurable fields that can be updated via POST."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Response"})," (200):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "sn": "INV003SIM03",\n  "ders": [\n    {\n      "type": "pv",\n      "enabled": true,\n      "rated_power": 10000,\n      "installed_power": 8500\n    },\n    {\n      "type": "battery",\n      "enabled": false,\n      "rated_power": 4800,\n      "capacity": 9600\n    },\n    {\n      "type": "meter",\n      "enabled": false\n    },\n    {\n      "type": "v2x_charger",\n      "enabled": true,\n      "capacity": 50000\n    }\n  ]\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"DER Field Reference"}),":"]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"DER Type"}),(0,r.jsx)(n.th,{children:"Field"}),(0,r.jsx)(n.th,{children:"Unit"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"pv"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"enabled"})}),(0,r.jsx)(n.td,{children:"-"}),(0,r.jsx)(n.td,{children:"Enable/disable publishing"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"pv"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"rated_power"})}),(0,r.jsx)(n.td,{children:"W"}),(0,r.jsx)(n.td,{children:"Inverter rated power"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"pv"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"installed_power"})}),(0,r.jsx)(n.td,{children:"W"}),(0,r.jsx)(n.td,{children:"Actual installed panel power (kWp)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"battery"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"enabled"})}),(0,r.jsx)(n.td,{children:"-"}),(0,r.jsx)(n.td,{children:"Enable/disable publishing"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"battery"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"rated_power"})}),(0,r.jsx)(n.td,{children:"W"}),(0,r.jsx)(n.td,{children:"Battery inverter rated power"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"battery"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"capacity"})}),(0,r.jsx)(n.td,{children:"Wh"}),(0,r.jsx)(n.td,{children:"Battery capacity"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"meter"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"enabled"})}),(0,r.jsx)(n.td,{children:"-"}),(0,r.jsx)(n.td,{children:"Enable/disable publishing"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"v2x_charger"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"enabled"})}),(0,r.jsx)(n.td,{children:"-"}),(0,r.jsx)(n.td,{children:"Enable/disable publishing"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"v2x_charger"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"capacity"})}),(0,r.jsx)(n.td,{children:"Wh"}),(0,r.jsx)(n.td,{children:"EV battery capacity"})]})]})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Errors"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"404 - Device not found"}),"\n"]}),"\n",(0,r.jsxs)(n.h3,{id:"post-apidevicessnders",children:["POST ",(0,r.jsx)(n.code,{children:"/api/devices/{sn}/ders"})]}),"\n",(0,r.jsxs)(n.p,{children:["Update publish flags and static DER metadata in one request. For PV entries, supply ",(0,r.jsx)(n.code,{children:"rated_power"})," in watts. For battery entries, supply ",(0,r.jsx)(n.code,{children:"rated_power"})," (W) and ",(0,r.jsx)(n.code,{children:"capacity"})," (Wh). For v2x_charger entries, supply ",(0,r.jsx)(n.code,{children:"capacity"})," (Wh); power limits are read-only from the device. ",(0,r.jsx)(n.code,{children:"enabled"})," is optional here; omit it to leave the current publish state untouched. Only the DERs included in the payload are modified."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Request"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "ders": [\n    {\n      "type": "pv",\n      "rated_power": 10200\n    },\n    {\n      "type": "battery",\n      "enabled": true,\n      "rated_power": 5000,\n      "capacity": 12800\n    }\n  ]\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Response"})," (200):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{ "message": "DERs updated", "sn": "INV003SIM03" }\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Errors"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"400 - Missing ders array"}),"\n",(0,r.jsx)(n.li,{children:"404 - Device not found"}),"\n",(0,r.jsx)(n.li,{children:"500 - Failed to persist config"}),"\n"]}),"\n",(0,r.jsxs)(n.h3,{id:"get-apidevicessnregistersaddress",children:["GET ",(0,r.jsx)(n.code,{children:"/api/devices/{sn}/registers/{address}"})]}),"\n",(0,r.jsx)(n.p,{children:"Read Modbus register(s)."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Example"}),": ",(0,r.jsx)(n.code,{children:"GET /api/devices/INV003SIM03/registers/13045?type=u32&endianness=little&scale_factor=0.1&function_code=3"})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Query Parameters"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"type"})," (optional, default: ",(0,r.jsx)(n.code,{children:"u16"}),") - Data type: ",(0,r.jsx)(n.code,{children:"u16"}),", ",(0,r.jsx)(n.code,{children:"i16"}),", ",(0,r.jsx)(n.code,{children:"u32"}),", ",(0,r.jsx)(n.code,{children:"i32"}),", ",(0,r.jsx)(n.code,{children:"f32"}),", ",(0,r.jsx)(n.code,{children:"u64"}),", ",(0,r.jsx)(n.code,{children:"i64"}),", ",(0,r.jsx)(n.code,{children:"str"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"size"})," (optional) - Number of registers (1-125). Required for ",(0,r.jsx)(n.code,{children:"str"}),", overrides count for others."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"endianness"})," (optional, default: ",(0,r.jsx)(n.code,{children:"little"}),") - Byte order: ",(0,r.jsx)(n.code,{children:"little"})," or ",(0,r.jsx)(n.code,{children:"big"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"scale_factor"})," (optional, default: 1.0) - Multiply raw value (not for ",(0,r.jsx)(n.code,{children:"str"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"function_code"})," (optional, default: 4) - ",(0,r.jsx)(n.code,{children:"3"})," (holding) or ",(0,r.jsx)(n.code,{children:"4"})," (input)"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Response"})," (200):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "address": 13045,\n  "value": 523.4,\n  "type": "u32",\n  "registers": 2\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Bulk read"})," (no type, only size):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "address": 13045,\n  "count": 10,\n  "values": ["0x0001", "0x0002", "0x0003", ...]\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"String read"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "address": 4989,\n  "value": "SH10RT12345",\n  "type": "str",\n  "registers": 10\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Errors"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"400 - Invalid type/size or non-Modbus device"}),"\n",(0,r.jsx)(n.li,{children:"404 - Device not found"}),"\n",(0,r.jsx)(n.li,{children:"500 - Read failed"}),"\n"]}),"\n",(0,r.jsxs)(n.h3,{id:"post-apidevicessnregistersaddress",children:["POST ",(0,r.jsx)(n.code,{children:"/api/devices/{sn}/registers/{address}"})]}),"\n",(0,r.jsx)(n.p,{children:"Write single holding register."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Example"}),": ",(0,r.jsx)(n.code,{children:"POST /api/devices/INV003SIM03/registers/33010"})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Request"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{ "value": 5000 }\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Response"})," (200):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "message": "Register written successfully",\n  "address": 33010,\n  "value": 5000\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Errors"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"400 - Missing value or non-Modbus device"}),"\n",(0,r.jsx)(n.li,{children:"404 - Device not found"}),"\n",(0,r.jsx)(n.li,{children:"500 - Write failed"}),"\n"]}),"\n",(0,r.jsxs)(n.h3,{id:"post-apidevicessnregisters",children:["POST ",(0,r.jsx)(n.code,{children:"/api/devices/{sn}/registers"})]}),"\n",(0,r.jsx)(n.p,{children:"Batch write multiple holding registers."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Example"}),": ",(0,r.jsx)(n.code,{children:"POST /api/devices/INV003SIM03/registers"})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Request"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "33010": 5000,\n  "33011": 1234\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Response"})," (200):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "message": "Batch write completed",\n  "success": 2,\n  "failed": 0\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Errors"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"400 - Invalid JSON or non-Modbus device"}),"\n",(0,r.jsx)(n.li,{children:"404 - Device not found"}),"\n",(0,r.jsx)(n.li,{children:"207 - Partial success (check success/failed counts)"}),"\n"]}),"\n",(0,r.jsxs)(n.h3,{id:"post-apidevicessnwrite",children:["POST ",(0,r.jsx)(n.code,{children:"/api/devices/{sn}/write"})]}),"\n",(0,r.jsx)(n.p,{children:"Write single holding register (Legacy/Alternative)."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Example"}),": ",(0,r.jsx)(n.code,{children:"POST /api/devices/INV003SIM03/write"})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Request"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "addr": 33010,\n  "value": 5000\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Response"})," (200):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "message": "Register written successfully"\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Errors"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"400 - Missing addr/value or non-Modbus device"}),"\n",(0,r.jsx)(n.li,{children:"404 - Device not found or write failed"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"control--operations",children:"Control & Operations"}),"\n",(0,r.jsxs)(n.h3,{id:"post-apicontrolsninit",children:["POST ",(0,r.jsx)(n.code,{children:"/api/control/{sn}/init"})]}),"\n",(0,r.jsx)(n.p,{children:"Initialize control for a device (e.g. take control of inverter)."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Response"})," (202):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "status": "queued",\n  "sn": "INV003SIM03",\n  "action": "init"\n}\n'})}),"\n",(0,r.jsxs)(n.h3,{id:"post-apicontrolsnbattery",children:["POST ",(0,r.jsx)(n.code,{children:"/api/control/{sn}/battery"})]}),"\n",(0,r.jsx)(n.p,{children:"Set battery charge/discharge power."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Request"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "power_w": 1000,\n  "command_id": "optional-uuid"\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.em,{children:"Positive value = Charge, Negative value = Discharge"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Response"})," (202):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "status": "queued",\n  "sn": "INV003SIM03",\n  "action": "battery",\n  "power_w": 1000\n}\n'})}),"\n",(0,r.jsxs)(n.h3,{id:"post-apicontrolsncurtail",children:["POST ",(0,r.jsx)(n.code,{children:"/api/control/{sn}/curtail"})]}),"\n",(0,r.jsx)(n.p,{children:"Set PV curtailment (limit solar generation)."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Request"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{ "power_w": 5000 }\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Response"})," (202):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "status": "queued",\n  "sn": "INV003SIM03",\n  "action": "curtail",\n  "power_w": 5000\n}\n'})}),"\n",(0,r.jsxs)(n.h3,{id:"post-apicontrolsncurtaildisable",children:["POST ",(0,r.jsx)(n.code,{children:"/api/control/{sn}/curtail/disable"})]}),"\n",(0,r.jsx)(n.p,{children:"Disable PV curtailment."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Response"})," (202):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "status": "queued",\n  "sn": "INV003SIM03",\n  "action": "curtail_disable"\n}\n'})}),"\n",(0,r.jsxs)(n.h3,{id:"post-apicontrolsndeinit",children:["POST ",(0,r.jsx)(n.code,{children:"/api/control/{sn}/deinit"})]}),"\n",(0,r.jsx)(n.p,{children:"Release control of device (return to default/self-consumption mode)."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Response"})," (202):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "status": "queued",\n  "sn": "INV003SIM03",\n  "action": "deinit"\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"mqtt-control-topics",children:"MQTT Control Topics"}),"\n",(0,r.jsx)(n.p,{children:"The firmware subscribes to the following topics for backend control."}),"\n",(0,r.jsx)(n.h4,{id:"battery-control",children:"Battery Control"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Topic"}),": ",(0,r.jsx)(n.code,{children:"control/{gateway_id}/battery/+/ems/commands"}),"\n",(0,r.jsx)(n.strong,{children:"Wildcard"}),": ",(0,r.jsx)(n.code,{children:"+"})," is the device serial number."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Payload"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "power_w": 1000,\n  "command_id": "optional-uuid"\n}\n'})}),"\n",(0,r.jsx)(n.h4,{id:"pv-curtailment",children:"PV Curtailment"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Topic"}),": ",(0,r.jsx)(n.code,{children:"control/{gateway_id}/pv/+/ems/commands"}),"\n",(0,r.jsx)(n.strong,{children:"Wildcard"}),": ",(0,r.jsx)(n.code,{children:"+"})," is the device serial number."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Payload"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "power_w": 5000\n}\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"identity--security",children:"Identity & Security"}),"\n",(0,r.jsx)(n.h3,{id:"get-apicrypto",children:"GET /api/crypto"}),"\n",(0,r.jsx)(n.p,{children:"Get device identity information."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Response"})," (200):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "deviceName": "software_zap",\n  "serialNumber": "abc123def456",\n  "publicKey": "04a1b2c3..."\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"post-apicryptosign",children:"POST /api/crypto/sign"}),"\n",(0,r.jsx)(n.p,{children:"Sign a message with the device's private key."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Request"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "message": "optional-message-content",\n  "timestamp": "optional-timestamp"\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Response"})," (200):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "sign": "3045022100...",\n  "message": "optional-message-content|nonce|timestamp|serial"\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"get-apiname",children:"GET /api/name"}),"\n",(0,r.jsx)(n.p,{children:"Get device name (ID)."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Response"})," (200):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "name": "abc123def456"\n}\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"utilities",children:"Utilities"}),"\n",(0,r.jsx)(n.h3,{id:"get-apidebug",children:"GET /api/debug"}),"\n",(0,r.jsx)(n.p,{children:"Get debug report."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Response"})," (200):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "status": "success",\n  "heap": { ... },\n  "tasks": [ ... ]\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"post-apiecho",children:"POST /api/echo"}),"\n",(0,r.jsx)(n.p,{children:"Echo the request body."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Request"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{ "any": "content" }\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Response"})," (200):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "echo": "{\\"any\\":\\"content\\"}"\n}\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"reference",children:"Reference"}),"\n",(0,r.jsx)(n.h3,{id:"status-codes",children:"Status Codes"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"200"})," OK"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"201"})," Created"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"204"})," No Content"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"400"})," Bad Request"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"404"})," Not Found"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"405"})," Method Not Allowed"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"409"})," Conflict"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"500"})," Internal Server Error"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"501"})," Not Implemented"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"503"})," Service Unavailable"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"examples",children:"Examples"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Add TCP device"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'curl -X POST http://192.168.1.100/api/devices \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "type": "modbus_tcp",\n    "ip": "192.168.1.50",\n    "port": 502,\n    "unit_id": 1,\n    "profile": "sungrow"\n  }\'\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Add MQTT device (Ferroamp)"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'curl -X POST http://192.168.1.100/api/devices \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "type": "mqtt",\n    "profile": "ferroamp",\n    "broker_host": "192.168.1.70",\n    "broker_port": 1883,\n    "username": "extapi",\n    "password": "your_password"\n  }\'\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Add P1 UART device"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'curl -X POST http://192.168.1.100/api/devices \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "type": "p1_uart",\n    "manufacturer": "MyMeter",\n    "baud_rate": 115200,\n    "data_bits": 8,\n    "parity": "none",\n    "stop_bits": 1\n  }\'\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Read register (scaled)"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'curl "http://192.168.1.100/api/devices/INV003SIM03/registers/13045?type=u32&scale_factor=0.1"\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Write register"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'curl -X POST http://192.168.1.100/api/devices/INV003SIM03/registers/33010 \\\n  -H "Content-Type: application/json" \\\n  -d \'{"value": 5000}\'\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Get device data"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"curl http://192.168.1.100/api/devices/INV003SIM03/data/json\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Remove device"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"curl -X DELETE http://192.168.1.100/api/devices/INV003SIM03\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Remove all devices"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"curl -X DELETE http://192.168.1.100/api/devices\n"})}),"\n",(0,r.jsx)(n.h3,{id:"notes",children:"Notes"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Device configs persist in ",(0,r.jsx)(n.code,{children:"/spiffs/devices/\\{sn\\}.json"})]}),"\n",(0,r.jsx)(n.li,{children:"Auto-reconnect every 10s for disconnected devices"}),"\n",(0,r.jsx)(n.li,{children:"Modbus timeout: 1000ms per request"}),"\n",(0,r.jsx)(n.li,{children:"UART pins fixed by firmware (RTU only configures baud/unit_id)"}),"\n",(0,r.jsxs)(n.li,{children:["Register read/write defaults to Input registers (use ",(0,r.jsx)(n.code,{children:"function_code=3"})," for Holding)"]}),"\n",(0,r.jsx)(n.li,{children:"Wrong HTTP method returns 405"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>c});var i=s(6540);const r={},d=i.createContext(r);function l(e){const n=i.useContext(d);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),i.createElement(d.Provider,{value:n},e.children)}}}]);