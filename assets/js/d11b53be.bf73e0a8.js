"use strict";(self.webpackChunksrcful_documentation=self.webpackChunksrcful_documentation||[]).push([[890],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>h});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=n.createContext({}),p=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},c=function(e){var t=p(e.components);return n.createElement(l.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=p(a),m=r,h=d["".concat(l,".").concat(m)]||d[m]||u[m]||i;return a?n.createElement(h,o(o({ref:t},c),{},{components:a})):n.createElement(h,o({ref:t},c))}));function h(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,o=new Array(i);o[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[d]="string"==typeof e?e:r,o[1]=s;for(var p=2;p<i;p++)o[p]=a[p];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},8037:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>p});var n=a(7462),r=(a(7294),a(3905));const i={sidebar_position:1,slug:"/developer/hardware",pagination_prev:null},o="Hardware/Firmware Guide",s={unversionedId:"developer/hardware",id:"developer/hardware",title:"Hardware/Firmware Guide",description:"This document describes basic requirements for a device to be compatible with the Sourceful Energy Network (SEN). The focus is for firmware compatibility. Document is under development.",source:"@site/docs/developer/hardware.md",sourceDirName:"developer",slug:"/developer/hardware",permalink:"/developer/hardware",draft:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,slug:"/developer/hardware",pagination_prev:null},sidebar:"tutorialSidebar",next:{title:"Price API Developer Guide",permalink:"/developer/price_api"}},l={},p=[{value:"Basics",id:"basics",level:2},{value:"Examples",id:"examples",level:2},{value:"ESP32",id:"esp32",level:3},{value:"Sourceful Energy Gateway Firmware",id:"sourceful-energy-gateway-firmware",level:3},{value:"Core Specifications",id:"core-specifications",level:2},{value:"Software Implementation",id:"software-implementation",level:2},{value:"Python Example",id:"python-example",level:3},{value:"SEN Onboarding",id:"sen-onboarding",level:2},{value:"Inception",id:"inception",level:3},{value:"Location",id:"location",level:3},{value:"User Experience",id:"user-experience",level:2},{value:"Local Interface",id:"local-interface",level:3},{value:"Bespoke App",id:"bespoke-app",level:3},{value:"Sourceful Energy App",id:"sourceful-energy-app",level:3},{value:"Network Connectivity",id:"network-connectivity",level:3},{value:"REST Endpoints",id:"rest-endpoints",level:2},{value:"Crypto Information",id:"crypto-information",level:2},{value:"Response",id:"response",level:3},{value:"Success (200 OK)",id:"success-200-ok",level:4},{value:"Crypto Sign",id:"crypto-sign",level:2},{value:"Wallet Recovery",id:"wallet-recovery",level:3},{value:"Request Parameters",id:"request-parameters",level:3},{value:"Response",id:"response-1",level:3},{value:"Success (200 OK)",id:"success-200-ok-1",level:4},{value:"Error (400 Bad Request) - When message contains pipe characters",id:"error-400-bad-request---when-message-contains-pipe-characters",level:4},{value:"Error (400 Bad Request) - When timestamp contains pipe characters",id:"error-400-bad-request---when-timestamp-contains-pipe-characters",level:4},{value:"WiFi Status",id:"wifi-status",level:2},{value:"Response",id:"response-2",level:3},{value:"Success (200 OK)",id:"success-200-ok-2",level:4},{value:"WiFi Configuration",id:"wifi-configuration",level:2},{value:"Request Parameters",id:"request-parameters-1",level:3},{value:"Response",id:"response-3",level:3},{value:"Success (200 OK)",id:"success-200-ok-3",level:4},{value:"Error (400 Bad Request)",id:"error-400-bad-request",level:4},{value:"Error (500 Internal Server Error)",id:"error-500-internal-server-error",level:4},{value:"WiFi Scan",id:"wifi-scan",level:2},{value:"Response",id:"response-4",level:3},{value:"Success (200 OK)",id:"success-200-ok-4",level:4},{value:"BLE Stop",id:"ble-stop",level:2},{value:"Response",id:"response-5",level:3},{value:"Success (200 OK)",id:"success-200-ok-5",level:4},{value:"Error (400 Bad Request) - When BLE not enabled",id:"error-400-bad-request---when-ble-not-enabled",level:4},{value:"Authentication",id:"authentication",level:2},{value:"Format of Responses",id:"format-of-responses",level:2},{value:"Additional Notes",id:"additional-notes",level:2},{value:"Header",id:"header",level:2},{value:"Energy Meter Header Example",id:"energy-meter-header-example",level:3},{value:"Payload",id:"payload",level:2},{value:"Energy Meter Payload Example",id:"energy-meter-payload-example",level:3},{value:"Signature",id:"signature",level:2},{value:"Full Signed JWT Energy Meter Example",id:"full-signed-jwt-energy-meter-example",level:3}],c={toc:p},d="wrapper";function u(e){let{components:t,...a}=e;return(0,r.kt)(d,(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"hardwarefirmware-guide"},"Hardware/Firmware Guide"),(0,r.kt)("p",null,"This document describes basic requirements for a device to be compatible with the Sourceful Energy Network (SEN). The focus is for firmware compatibility. Document is under development."),(0,r.kt)("p",null,"While there are many types of devices that can be connected to the SEN they are all regarded as gateways in the SEN, the gateway is then responsible for collecting data and controlling one or several energy resources. Some gateways are more specialized, e.g., a p1 reader (that essentially acts as a gateway to a smart energy meter) and some are more generic in nature, e.g., the Sourceful Energy Gateway."),(0,r.kt)("p",null,"The firmwares for boath the Sourceful Energy Gateway and Sourceful Energy Zap are open source and can serve as a generic reference implementations:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/srcfl/srcful-gateway"},"https://github.com/srcfl/srcful-gateway")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/srcfl/srcful-zap-firmware"},"https://github.com/srcfl/srcful-zap-firmware"))),(0,r.kt)("h2",{id:"basics"},"Basics"),(0,r.kt)("p",null,"A gateway needs to be identifiable and provide a public key. Gateway id and public key needs to be registered with SEN before the gateway is usable. Internally a gateway needs to maintain the private key and sign data."),(0,r.kt)("p",null,"All hardware devices will need to be audited and tested before granted access to the network and public release."),(0,r.kt)("h2",{id:"examples"},"Examples"),(0,r.kt)("h3",{id:"esp32"},"ESP32"),(0,r.kt)("p",null,"The Sourceful Energy Zap an ESP32 project (p1 smart energy meter reader) under development at: ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/srcfl/srcful-zap-firmware"},"https://github.com/srcfl/srcful-zap-firmware")),(0,r.kt)("p",null,"It shows:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Handling of cryptographic keys in software"),(0,r.kt)("li",{parentName:"ul"},"Construction and signing of data JWTs"),(0,r.kt)("li",{parentName:"ul"},"Construction and signing of Inception message"),(0,r.kt)("li",{parentName:"ul"},"BLE message protocol"),(0,r.kt)("li",{parentName:"ul"},"Important REST endpoints for onboarding")),(0,r.kt)("h3",{id:"sourceful-energy-gateway-firmware"},"Sourceful Energy Gateway Firmware"),(0,r.kt)("p",null,"While in development the full firmware of the Sourceful Energy Gateway is open source and can work as a reference implementation. This firmware is suitable for micro computers such as raspberry pi 4+ that can run containerized applications."),(0,r.kt)("p",null,"You find the project here: ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/srcfl/srcful-gateway"},"https://github.com/srcfl/srcful-gateway")),(0,r.kt)("h1",{id:"cryptographic-implementation"},"Cryptographic Implementation"),(0,r.kt)("p",null,"The SEN relies on cryptographic signatures to validate the source of data, ownership of gateways etc."),(0,r.kt)("p",null,"The SEN uses ECDSA (Elliptic Curve Digital Signature Algorithm) for cryptographic operations, implemented in two ways:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Hardware-based using ATECC608A/B secure elements"),(0,r.kt)("li",{parentName:"ol"},"Software-based, e.g., using Python's ",(0,r.kt)("inlineCode",{parentName:"li"},"ecdsa")," library")),(0,r.kt)("h2",{id:"core-specifications"},"Core Specifications"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Algorithm"),": ECDSA"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Curve"),": SECP256r1 "),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Key Sizes"),": ",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Private Key: 32 bytes (256 bits)"),(0,r.kt)("li",{parentName:"ul"},"Public Key: 64 bytes (x,y coordinates, 32 bytes each)")))),(0,r.kt)("h2",{id:"software-implementation"},"Software Implementation"),(0,r.kt)("p",null,"If software keys are used it is imperative that the private key is stored on the device itself. The private key must not be stored in plain text in files, code nor as environment variables. If a private key is regarded as compromized by the netwowk it's corresponding public key will be banned in the SEN potentially resulting in loss of rewards and other negative effects."),(0,r.kt)("h3",{id:"python-example"},"Python Example"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'import json\nimport base64\nfrom cryptography.hazmat.primitives import hashes\nfrom cryptography.hazmat.primitives.asymmetric import ec, utils\n\ndef base64url_encode(data: bytes) -> str:\n    return base64.urlsafe_b64encode(data).rstrip(b\'=\').decode(\'utf-8\')\n\n# Generate a new private key\nprivate_key = ec.generate_private_key(ec.SECP256R1())\npublic_key = private_key.public_key()\n\n# Get the private key number\nprivate_numbers = private_key.private_numbers()\nprivate_key_hex = f"{private_numbers.private_value:064x}"\nprint(f"Private key: {private_key_hex}")\n\n# Get the public key coordinates\npublic_numbers = public_key.public_numbers()\npublic_key_hex = f"{public_numbers.x:064x}{public_numbers.y:064x}"\nprint(f"Public key: {public_key_hex}")\n\n# Create a JWT\nheader = {\n    "alg": "ES256",\n    "typ": "JWT",\n    "device": "test123",\n    "opr": "testing"\n}\n\npayload = {\n    "message": "Hello, World!",\n    "timestamp": 1234567890\n}\n\n# Encode header and payload\nheader_b64 = base64url_encode(json.dumps(header).encode())\npayload_b64 = base64url_encode(json.dumps(payload).encode())\n\n# Create message to sign\nmessage = f"{header_b64}.{payload_b64}".encode()\n\n# Hash the message\ndigest = hashes.Hash(hashes.SHA256())\ndigest.update(message)\nmessage_hash = digest.finalize()\n\n# Sign the message\nsignature = private_key.sign(\n    message_hash,\n    ec.ECDSA(utils.Prehashed(hashes.SHA256()))\n)\n\n# Convert DER signature to raw R,S format\nr, s = utils.decode_dss_signature(signature)\nsignature_bytes = r.to_bytes(32, byteorder=\'big\') + s.to_bytes(32, byteorder=\'big\')\nsignature_b64 = base64url_encode(signature_bytes)\n\n# Create final JWT\njwt = f"{header_b64}.{payload_b64}.{signature_b64}"\nprint(f"\\nGenerated JWT:\\n{jwt}")\n')),(0,r.kt)("h2",{id:"sen-onboarding"},"SEN Onboarding"),(0,r.kt)("p",null,"Gateway id and public key needs to be registered with SEN before the gateway is usable. Basically, the id and public key is submitted to the network and then registered. In the future, this procedure will be automated through the developer platform and developer APIs."),(0,r.kt)("p",null,"Before a gateway is usable on the SEN, it must be tied to a wallet public key (inception), e.g., the user's wallet, and finally be given a correct physical location."),(0,r.kt)("h3",{id:"inception"},"Inception"),(0,r.kt)("p",null,"The gateway must accept the wallet public key and add its own id and a cryptographic signature. The gateway then initializes the device in the SEN API."),(0,r.kt)("p",null,"When the gateway is tied to a wallet, further calls to this endpoint in the the SEN API will fail."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-graphql"},'mutation {\n      gatewayInception {\n        initialize(gatewayInitialization:{idAndWallet:"gateway_id:wallet_public_key", signature:"signature_of_idAndWallet"}) {\n          initialized\n        }\n      }\n    }\n')),(0,r.kt)("h3",{id:"location"},"Location"),(0,r.kt)("p",null,"The location for a gateway is important from a standpoint of validity. The Network relies on accurate positions of resources, to e.g., know that a resource is part of a particular area."),(0,r.kt)("p",null,"Setting the location for a gateway is based on a signature from the owning wallet (see Inception above). The gateway hardware/keys are not part of this, and this part can thus be handled in different ways. The Sourceful Energy App offers setting the location of a device for all gateways a wallet has been paired with."),(0,r.kt)("h2",{id:"user-experience"},"User Experience"),(0,r.kt)("p",null,"The user experience of onboarding can vary depending on the level of integration desired. Basically, it is up to each gateway firmware to provide the means for:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Network connectivity - most devices would need some kind of Network access, e.g., WiFi credentials"),(0,r.kt)("li",{parentName:"ul"},"Inception/Initialisation"),(0,r.kt)("li",{parentName:"ul"},"Location (Optional)")),(0,r.kt)("h3",{id:"local-interface"},"Local Interface"),(0,r.kt)("p",null,"In the simplest form, this is handled via the gateway itself, via a local interface, e.g., an internal webpage. This may be sufficient for a deeply technical product, possibly with other complex configuration of connected devices etc. The main caveat for a unified user experience in this case is the integration of the wallet key. There are, however, modules for most popular web frameworks that can handle this seamlessly. In the simplest case, the user will need to copy paste the wallet public key into the local interface. Depending on needs, the local interface can be as advanced as needed and provide a full user experience by utilizing the data egress of the SEN Network to do visualizations etc."),(0,r.kt)("h3",{id:"bespoke-app"},"Bespoke App"),(0,r.kt)("p",null,"For a more non-technical user experience, a bespoke App that communicates with the gateway may be developed."),(0,r.kt)("h3",{id:"sourceful-energy-app"},"Sourceful Energy App"),(0,r.kt)("p",null,"The onboarding may be integrated into the Sourceful Energy App (SEA) for a seamless experience into the Network. Using the SEA, the user can always set location of an owned gateway. The SEA also offers Network connectivity, inception integration of the gateway, and a walletless mode (for users that do not have a separate crypto wallet) but this requires additional functionality in the gateway firmware. There are two basic ways to connect the client and the gateway for onboarding, soft ap or BLE. We recoomend ble for a smoother user experience and compatibility with web apps."),(0,r.kt)("p",null,"Wifi provisioning is an optional step and is placed last. The SEA does not require the gateway to have internet connectivity to be onboarded to the network per se (but it would obviously need to send data to the network at some point to be useful). Low spec devices can therefore do the onboarding using e.g. BLE only, no messages needs to be sent from the gateway to the backend during this process. The advantage is that the gateway does not need to maintain e.g. BLE stack and SSL Certificates at the same time. In essence the gateway can become operational after it has a wifi connection and BLE has been stoped."),(0,r.kt)("p",null,"Onboarding via BLE looks like this:"),(0,r.kt)("mermaid",{value:"sequenceDiagram\n    participant U as User\n    participant C as Client\n    participant G as Gateway\n    participant B as Backend\n\n    U->>G: Enable Config Mode\n    U->>C: Onboard Gateway\n\n    C->>G: Connect via BLE\n\n    C->>G: GET api/crypto\n    G--\x3e>C: serial & public key\n    C->>U: Display serial & public key\n\n    U->>C: Claim gateway\n    C->>B: Check gateway status (serial)\n    B--\x3e>C: Return gateway info (exists, wallet, location)\n\n    U->>C: Request gateway registration message\n    C->>G: POST api/crypto/sign (wallet public key, timestamp)\n    G--\x3e>C: Return gateway message and signature\n\n    C->>B: Initialize gateway (gateway message, signature)\n    B--\x3e>C: Confirmation\n\n    U->>C: Provide gateway location\n    C->>U: Request location message signature\n    U--\x3e>C: location message wallet signature\n\n    C->>B: Set gateway location (location message)\n    B--\x3e>C: Location confirmed\n\n    Note over U,B: WiFi Provisioning Process\n\n    U->>C: Complete onboarding\n    C->>G: POST api/ble/stop\n    G--\x3e>C: Status OK\n    Note over G: Optionally Disable BLE & exit config mode\n    C->>G: BLE Disconnect\n\n    C->>U: Request credentials signature\n    U--\x3e>C: Sign gateway credentials"}),(0,r.kt)("h3",{id:"network-connectivity"},"Network Connectivity"),(0,r.kt)("p",null,"Wifi provisioning is done using a few endpoints ",(0,r.kt)("inlineCode",{parentName:"p"},"GET api/wifi"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"POST api/wifi")," and 'GET api/wifi/scan`. We reccomend that the gateway performs a network scan when entering its configuration mode. There is no call to scan per unless the user initiates it."),(0,r.kt)("p",null,"The wifi provisioning process looks like this:"),(0,r.kt)("mermaid",{value:"sequenceDiagram\n    participant U as User\n    participant C as Client\n    participant G as Gateway\n    \n    C->>G: GET api/wifi\n    G--\x3e>C: SSIDs list & current connection status\n    C->>U: Display available networks\n\n    opt User requests refresh\n        U->>C: Scan for networks\n        C->>G: GET api/wifi/scan\n        G--\x3e>C: Scanning...\n        Note over G: Perform WiFi scan\n        G--\x3e>C: Available networks\n        C->>U: Display updated networks\n    end\n\n    U->>C: Select network & provide password\n\n    C->>G: POST api/wifi (ssid, password)\n    Note over G: Attempt connection\n    G--\x3e>C: Connection status\n\n    C->>G: GET api/wifi\n    G--\x3e>C: Connected: selected SSID\n    C->>U: Display connection success"}),(0,r.kt)("h1",{id:"local-api-endpoints"},"Local API Endpoints"),(0,r.kt)("p",null,"The following endpoints need to be implemented to support onboarding in the SEA."),(0,r.kt)("h2",{id:"rest-endpoints"},"REST Endpoints"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#crypto-information"},"Crypto Information")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#crypto-sign"},"Crypto Sign")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#wifi-status"},"WiFi Status")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#wifi-configuration"},"WiFi Configuration")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#wifi-scan"},"WiFi Scan")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#ble-stop"},"BLE Stop"))),(0,r.kt)("h2",{id:"crypto-information"},"Crypto Information"),(0,r.kt)("p",null,"Get cryptographic information about the device."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Endpoint:")," ",(0,r.kt)("inlineCode",{parentName:"p"},"/api/crypto"),(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("strong",{parentName:"p"},"Method:")," ",(0,r.kt)("inlineCode",{parentName:"p"},"GET"),(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("strong",{parentName:"p"},"Content Type:")," ",(0,r.kt)("inlineCode",{parentName:"p"},"application/json")),(0,r.kt)("h3",{id:"response"},"Response"),(0,r.kt)("h4",{id:"success-200-ok"},"Success (200 OK)"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "deviceName": "software_zap",\n  "serialNumber": "DEVICE_SERIAL_NUMBER",\n  "publicKey": "PUBLIC_KEY_HEX"\n}\n')),(0,r.kt)("h2",{id:"crypto-sign"},"Crypto Sign"),(0,r.kt)("p",null,"Sign a message using the device's private key."),(0,r.kt)("h3",{id:"wallet-recovery"},"Wallet Recovery"),(0,r.kt)("p",null,"For gateways that are integrated into the SEA there is a need for a wallet recovery flow. The purpose is for users to be able to recover their wallet private key if it has been created in the SEA (this is naturally not possible for external wallets such as Phantom). The user will need their recovery key and acces to a gateway they have connected to the wallet. From the gateways perspective this is rather simple, all that is needed is an enpoint that can create a signature based on a message. This endpoint should be accessible via BLE or local Network access via mDNS."),(0,r.kt)("p",null,"The gateway would need to be put in eg. a mode that enables bluetooth, and the ",(0,r.kt)("inlineCode",{parentName:"p"},"ble/stop")," message will be sent when the flow has finished and the gateway can resume normal operations."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Endpoint:")," ",(0,r.kt)("inlineCode",{parentName:"p"},"/api/crypto/sign"),(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("strong",{parentName:"p"},"Method:")," ",(0,r.kt)("inlineCode",{parentName:"p"},"POST"),(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("strong",{parentName:"p"},"Content Type:")," ",(0,r.kt)("inlineCode",{parentName:"p"},"application/json")),(0,r.kt)("h3",{id:"request-parameters"},"Request Parameters"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Required"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"message"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Message to sign (must not contain ","|"," (pipe) characters)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"timestamp"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Timestamp to use should be in UTC Y-m-dTH:M:SZ format eg 2025-01-17T18:20:12Z")))),(0,r.kt)("h3",{id:"response-1"},"Response"),(0,r.kt)("h4",{id:"success-200-ok-1"},"Success (200 OK)"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "message": "MESSAGE|NONCE|TIMESTAMP|SERIAL",\n  "sign": "SIGNATURE_HEX"\n}\n')),(0,r.kt)("p",null,"If timestamp is not provided the device time will be used. This can be a problem if the device does not have the correct time, i.e. it has not established the correct time using e.g. NTP yet. In such cases a caller can inject the time instead.\n",(0,r.kt)("strong",{parentName:"p"},"Note:")," If no message is provided, the resulting message format will be ",(0,r.kt)("inlineCode",{parentName:"p"},"NONCE|TIMESTAMP|SERIAL")," (without a leading pipe character)."),(0,r.kt)("h4",{id:"error-400-bad-request---when-message-contains-pipe-characters"},"Error (400 Bad Request) - When message contains pipe characters"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "status": "error",\n  "message": "Message cannot contain | characters"\n}\n')),(0,r.kt)("h4",{id:"error-400-bad-request---when-timestamp-contains-pipe-characters"},"Error (400 Bad Request) - When timestamp contains pipe characters"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "status": "error",\n  "message": "Timestamp cannot contain | characters"\n}\n')),(0,r.kt)("h2",{id:"wifi-status"},"WiFi Status"),(0,r.kt)("p",null,"Get current WiFi connection status and available networks."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Endpoint:")," ",(0,r.kt)("inlineCode",{parentName:"p"},"/api/wifi"),(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("strong",{parentName:"p"},"Method:")," ",(0,r.kt)("inlineCode",{parentName:"p"},"GET"),(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("strong",{parentName:"p"},"Content Type:")," ",(0,r.kt)("inlineCode",{parentName:"p"},"application/json")),(0,r.kt)("h3",{id:"response-2"},"Response"),(0,r.kt)("h4",{id:"success-200-ok-2"},"Success (200 OK)"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "ssids": [\n    "Network1",\n    "Network2",\n    "Network3"\n  ],\n  "connected": "CONNECTED_NETWORK_NAME"\n}\n')),(0,r.kt)("p",null,'If not connected to any WiFi network, the "connected" field will be null.'),(0,r.kt)("h2",{id:"wifi-configuration"},"WiFi Configuration"),(0,r.kt)("p",null,"Configure WiFi credentials for the device."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Endpoint:")," ",(0,r.kt)("inlineCode",{parentName:"p"},"/api/wifi"),(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("strong",{parentName:"p"},"Method:")," ",(0,r.kt)("inlineCode",{parentName:"p"},"POST"),(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("strong",{parentName:"p"},"Content Type:")," ",(0,r.kt)("inlineCode",{parentName:"p"},"application/json")),(0,r.kt)("h3",{id:"request-parameters-1"},"Request Parameters"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Required"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"ssid"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"WiFi network name")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"psk"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"WiFi password")))),(0,r.kt)("h3",{id:"response-3"},"Response"),(0,r.kt)("h4",{id:"success-200-ok-3"},"Success (200 OK)"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "status": "success",\n  "message": "WiFi credentials updated and connected"\n}\n')),(0,r.kt)("h4",{id:"error-400-bad-request"},"Error (400 Bad Request)"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "status": "error",\n  "message": "Missing credentials"\n}\n')),(0,r.kt)("h4",{id:"error-500-internal-server-error"},"Error (500 Internal Server Error)"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "status": "error",\n  "message": "Failed to connect with provided credentials"\n}\n')),(0,r.kt)("h2",{id:"wifi-scan"},"WiFi Scan"),(0,r.kt)("p",null,"Initiate an asynchronous WiFi network scan."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Endpoint:")," ",(0,r.kt)("inlineCode",{parentName:"p"},"/api/wifi/scan"),(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("strong",{parentName:"p"},"Method:")," ",(0,r.kt)("inlineCode",{parentName:"p"},"GET"),(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("strong",{parentName:"p"},"Content Type:")," ",(0,r.kt)("inlineCode",{parentName:"p"},"application/json")),(0,r.kt)("h3",{id:"response-4"},"Response"),(0,r.kt)("h4",{id:"success-200-ok-4"},"Success (200 OK)"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "status": "scan initiated"\n}\n')),(0,r.kt)("h2",{id:"ble-stop"},"BLE Stop"),(0,r.kt)("p",null,"Schedule BLE service to stop."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Endpoint:")," ",(0,r.kt)("inlineCode",{parentName:"p"},"/api/ble/stop"),(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("strong",{parentName:"p"},"Method:")," ",(0,r.kt)("inlineCode",{parentName:"p"},"POST"),(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("strong",{parentName:"p"},"Content Type:")," ",(0,r.kt)("inlineCode",{parentName:"p"},"application/json")),(0,r.kt)("h3",{id:"response-5"},"Response"),(0,r.kt)("h4",{id:"success-200-ok-5"},"Success (200 OK)"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "status": "success",\n  "message": "BLE shutdown scheduled"\n}\n')),(0,r.kt)("h4",{id:"error-400-bad-request---when-ble-not-enabled"},"Error (400 Bad Request) - When BLE not enabled"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "status": "error",\n  "message": "BLE not enabled"\n}\n')),(0,r.kt)("h2",{id:"authentication"},"Authentication"),(0,r.kt)("p",null,"None of these endpoints require authentication. The device is designed to be accessed on a local network or via BLE."),(0,r.kt)("h2",{id:"format-of-responses"},"Format of Responses"),(0,r.kt)("p",null,"Responses are in JSON format with appropriate HTTP status codes. "),(0,r.kt)("h2",{id:"additional-notes"},"Additional Notes"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"These endpoints can be accessed both via HTTP and BLE interfaces"),(0,r.kt)("li",{parentName:"ul"},"BLE interfaces use a custom protocol to map these endpoints to BLE characteristics"),(0,r.kt)("li",{parentName:"ul"},"For timestamp formatting, the format is ",(0,r.kt)("inlineCode",{parentName:"li"},"YYYY-MM-DDThh:mm:ssZ")," (UTC time) ")),(0,r.kt)("h1",{id:"sen-data-ingress"},"SEN Data Ingress"),(0,r.kt)("p",null,"Gateways send data to the SEN using a signed JSON Web Token (JWT) format. You can read more about the format specification here: ",(0,r.kt)("a",{parentName:"p",href:"https://jwt.io/introduction"},"https://jwt.io/introduction"),". Frequency of sending is 10 seconds, but may be more seldom. You may send several data packages in the same payload of the JWT but the data needs to be from the same energy resource for each JWT. E.g. if a gateway is connected to both an inverter and a meter the data from the inverter needs to be sent in one JWT (with optionally many datapoints) and data from the meter in another JWT (with optionally many datapoints). "),(0,r.kt)("p",null,"In particular, data is ingested using signed JWTs (not encrypted) via HTTPS. I.e., standard safe HTTPS transport is used to perform end-to-end encryption of the data."),(0,r.kt)("h2",{id:"header"},"Header"),(0,r.kt)("p",null,"The header consists of the standard fields plus extra protocol-specific fields."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "alg": "ES256",    \n    "typ": "JWT",\n    "device": "device_id",\n    "opr": "testing",\n    "licence": "device licence key",\n    "developer": "developer licence key",\n    "model": "model string",\n    "dtype": "payload datatype specifics",\n    "sn": "data serial number"\n}\n')),(0,r.kt)("h3",{id:"energy-meter-header-example"},"Energy Meter Header Example"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "alg": "ES256",\n  "typ": "JWT",\n  "device": "0123752ceb741f6eee",\n  "opr": "production",\n  "model": "p1homewizard",\n  "dtype": "p1_telnet_json",\n  "sn": "LGF5E360"\n}\n')),(0,r.kt)("p",null,"One note is that technically the ",(0,r.kt)("inlineCode",{parentName:"p"},"ES256R")," algorithm/curve is used, that is ECDSA using SECP256r1 curve and SHA-256 and not ECDSA using P-256 curve and SHA-256."),(0,r.kt)("h2",{id:"payload"},"Payload"),(0,r.kt)("p",null,"The body consists of the data the device sends, this data consists of one or more timestamped JSON objects. This is not generally standardized at this point. Timestamps are always in UTC."),(0,r.kt)("h3",{id:"energy-meter-payload-example"},"Energy Meter Payload Example"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "1739352916813": {\n    "serial_number": "LGF5E360",\n    "rows": [\n      "0-0:1.0.0(250212103510W)",\n      "1-0:1.8.0(00010968.132*kWh)",\n      "1-0:2.8.0(00000000.000*kWh)",\n      "1-0:3.8.0(00000005.151*kVArh)",\n      "1-0:4.8.0(00002109.781*kVArh)",\n      "1-0:1.7.0(0000.253*kW)",\n      "1-0:2.7.0(0000.000*kW)",\n      "1-0:3.7.0(0000.000*kVAr)",\n      "1-0:4.7.0(0000.084*kVAr)",\n      "1-0:21.7.0(0000.064*kW)",\n      "1-0:22.7.0(0000.000*kW)",\n      "1-0:41.7.0(0000.161*kW)",\n      "1-0:42.7.0(0000.000*kW)",\n      "1-0:61.7.0(0000.028*kW)",\n      "1-0:62.7.0(0000.000*kW)",\n      "1-0:23.7.0(0000.000*kVAr)",\n      "1-0:24.7.0(0000.000*kVAr)",\n      "1-0:43.7.0(0000.000*kVAr)",\n      "1-0:44.7.0(0000.052*kVAr)",\n      "1-0:63.7.0(0000.000*kVAr)",\n      "1-0:64.7.0(0000.032*kVAr)",\n      "1-0:32.7.0(233.6*V)",\n      "1-0:52.7.0(233.0*V)",\n      "1-0:72.7.0(232.9*V)",\n      "1-0:31.7.0(000.2*A)",\n      "1-0:51.7.0(000.7*A)",\n      "1-0:71.7.0(000.1*A)",\n      "!0E78"\n    ],\n    "checksum": "0E78"\n  }\n}\n')),(0,r.kt)("h2",{id:"signature"},"Signature"),(0,r.kt)("p",null,"The signature is the signature generated by the device private key that can be verified by the public key."),(0,r.kt)("h3",{id:"full-signed-jwt-energy-meter-example"},"Full Signed JWT Energy Meter Example"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"eyJhbGciOiJFUzI1NiIsInR5cCI6IkpXVCIsImRldmljZSI6InphcC0wMDAwOThiOTNjODQ4MWIwIiwib3ByIjoicHJvZHVjdGlvbiIsIm1vZGVsIjoicDF6YXAiLCJkdHlwZSI6InAxX3RlbG5ldF9qc29uIiwic24iOiJ6YXAifQ.eyIxNzUwODQwNDIwMzY5Ijp7InNlcmlhbF9udW1iZXIiOiJ6YXAiLCJyb3dzIjpbIjAtMDoxLjAuMCgyNTA2MjUwOTMzNDBXKSIsIjEtMDoxLjcuMCgwLjAwMDAwMCprVykiLCIxLTA6Mi43LjAoMC4wMDAwMDAqa1cpIiwiMS0wOjMuNy4wKDAuMDAwMDAwKmtWQVIpIiwiMS0wOjQuNy4wKDAuMDAwMDAwKmtWQVIpIiwiMS0wOjMxLjcuMCgwLjAwMDAwMCpBKSIsIjEtMDo1MS43LjAoMC4wMDAwMDAqQSkiLCIxLTA6NzEuNy4wKDAuMDAwMDAwKkEpIiwiMS0wOjMyLjcuMCgyMTcuODAwMDAzKlYpIiwiMS0wOjUyLjcuMCgwLjAwMDAwMCpWKSIsIjEtMDo3Mi43LjAoMC4wMDAwMDAqVikiLCIxLTA6MjEuNy4wKDAuMDAwMDAwKmtXKSIsIjEtMDoyMi43LjAoMC4wMDAwMDAqa1cpIiwiMS0wOjIzLjcuMCgwLjAwMDAwMCprVkFSKSIsIjEtMDoyNC43LjAoMC4wMDAwMDAqa1ZBUikiLCIxLTA6NDEuNy4wKDAuMDAwMDAwKmtXKSIsIjEtMDo0Mi43LjAoMC4wMDAwMDAqa1cpIiwiMS0wOjQzLjcuMCgwLjAwMDAwMCprVkFSKSIsIjEtMDo0NC43LjAoMC4wMDAwMDAqa1ZBUikiLCIxLTA6NjEuNy4wKDAuMDAwMDAwKmtXKSIsIjEtMDo2Mi43LjAoMC4wMDAwMDAqa1cpIiwiMS0wOjYzLjcuMCgwLjAwMDAwMCprVkFSKSIsIjEtMDo2NC43LjAoMC4wMDAwMDAqa1ZBUikiLCIxLTA6MS44LjAoMjkuNTY1MDAxKmtXaCkiLCIxLTA6Mi44LjAoMC4wMDAwMDAqa1doKSIsIjEtMDozLjguMCgwLjAzNTAwMCprVkFSaCkiLCIxLTA6NC44LjAoNTQuOTQxMDAyKmtWQVJoKSJdLCJjaGVja3N1bSI6IkRFQUQifX0.ropuH66FKQ_WcymkBhsgj3yuxnxW9Ws8wdWfSkEs9IHOCxoNNEr9PQzR3mT4mW4dU2awKSJo_o0PU7SBaV7_sAoMDAwMC4wMDAqa1cpIiwgIjEtMDoyMy43LjAoMDAwMC4wMDAqa1ZBcikiLCAiMS0wOjI0LjcuMCgwMDAwLjAwMCprVkFyKSIsICIxLTA6NDMuNy4wKDAwMDAuMDAwKmtWQXIpIiwgIjEtMDo0NC43LjAoM\n")))}u.isMDXComponent=!0}}]);